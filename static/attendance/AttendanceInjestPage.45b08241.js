function e(e,t,s,a){Object.defineProperty(e,t,{get:s,set:a,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire2e1e,s=t.register;s("lKraE",function(s,a){Object.defineProperty(s.exports,"__esModule",{value:!0,configurable:!0}),e(s.exports,"default",()=>h);var n=t("ayMG0"),r=t("acw62"),l=t("jEyqx"),o=t("8Qx3l"),c=t("br3ru"),i=t("aphAM"),u=t("aSXNm");let d={1:"Present",0:"Absent",P:"Present",A:"Absent",p:"Present",a:"Absent",TRUE:"Present",FALSE:"Absent"};var h=()=>{let{subjectClassPK:e}=(0,i.useParams)(),[t,s]=(0,r.useState)([]),a=(0,r.useRef)(null),h=(0,r.useRef)(null),[f,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)({});async function j(){let{all_attendance:t}=await (0,c.default)(e),s={};for(let{mail:e,status:a}of t)s[e]=a;return b(s),s}async function y(){g(!0);let s=t.map(({mail:e,status:t})=>({mail:e,status:t.toLowerCase()}));(0,u.default)(e,s).then(async()=>{g(!1),await j()}).catch(e=>{console.log(e),g(!1)})}function w(){let e=a.current.value.trim().split("\n"),t=h.current.value.trim().split("\n");if(e.length!==t.length){m("Length mismatch");return}m(""),1===e.length&&""===e[0]&&(e.pop(),t.pop()),s(e.map((e,s)=>{e=e.replace("@ms.sst.scaler.com","@sst.scaler.com");let a=d[t[s]],n=p[e];return{mail:e,status:a,serverStatus:n}}))}(0,r.useEffect)(()=>{j()},[]),(0,r.useEffect)(w,[p]);let{presentCount:v,absentCount:N,unknownCount:S}=function(){let e=0,s=0,a=0;for(let{status:n}of t)"Present"===n?e++:"Absent"===n?s++:a++;return{presentCount:e,absentCount:s,unknownCount:a}}(),A=0===t.filter(({serverStatus:e})=>!e).length,P=x||0===t.length||f.length>0||!A;return(0,n.jsxs)("div",{className:"flex flex-col gap-8 p-8 h-full",children:[(0,n.jsxs)("div",{className:"flex justify-evenly h-40",children:[(0,n.jsx)("textarea",{ref:a,rows:5,className:"border bg-gray-100 w-2/5",placeholder:"Paste emails from gsheet here",onChange:w}),(0,n.jsx)("textarea",{ref:h,rows:5,className:"border bg-gray-100 1/5",placeholder:"Paste attendance from gsheet here",onChange:w}),(0,n.jsx)("div",{children:(0,n.jsxs)("button",{disabled:P,onClick:y,type:"button",className:`px-8 py-3 rounded text-white bg-blue-700 ${P?"bg-gray-500":"hover:bg-blue-800"}`,children:[x?(0,n.jsx)(l.FontAwesomeIcon,{icon:o.faSpinner,spin:!0,size:"1x",color:"white"}):(0,n.jsx)(l.FontAwesomeIcon,{icon:o.faUpload,size:"1x",color:"white"}),"Upload"]})})]}),f&&(0,n.jsx)("div",{className:"text-red-500",children:f}),(0,n.jsxs)("table",{className:"w-full mt-8 text-left bg-white border border-gray-300",children:[(0,n.jsx)("thead",{className:"bg-gray-200",children:(0,n.jsxs)("tr",{className:"[&>*]:py-2",children:[(0,n.jsx)("th",{children:"#"}),(0,n.jsxs)("th",{children:["Emails: (",t.length,")"]}),(0,n.jsxs)("th",{className:"flex flex-col",children:[(0,n.jsxs)("span",{children:["Attendances: (",t.length,")"]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,n.jsxs)("span",{children:[v," Present"]}),(0,n.jsxs)("span",{children:[N," Absent"]}),S>0&&(0,n.jsxs)("span",{children:[S," Unknown"]})]})]}),(0,n.jsx)("th",{children:"Server Status"})]})}),(0,n.jsx)("tbody",{className:"overflow-y-auto",children:t.map(({mail:e,status:t,serverStatus:s},a)=>{let r=a%2==0?"bg-gray-100":"bg-white";return r=s?t===s?"bg-green-400":"bg-yellow-400":"bg-red-400",(0,n.jsxs)("tr",{className:r,children:[(0,n.jsx)("td",{children:a+1}),(0,n.jsx)("td",{className:"py-2",children:e}),(0,n.jsx)("td",{className:"py-2",children:t}),(0,n.jsx)("td",{className:"py-2",children:s||"?"})]},a+e)})})]})]})}}),s("br3ru",function(t,s){e(t.exports,"default",()=>a);var a=async e=>{let t=e?`/attendance/getAttendance/${e}/`:getAttendanceURL;try{let e=await fetch(t);if(!e.ok)throw alert("Failed to fetch course details"),Error("Failed to fetch course details");let s=await e.json();return s.all_attendance=s.all_attendance.sort((e,t)=>e.mail.localeCompare(t.mail)),s}catch(e){return console.error(e),null}}}),s("aSXNm",function(t,s){e(t.exports,"default",()=>a);var a=function(e,t){let s=`/attendance/v0/builk_mark_attendance/${e}/`;return new Promise(async(e,a)=>{try{let n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":csrftoken,mode:"same-origin"},body:JSON.stringify(t)});if(n.ok){let t=await n.json();console.log(`Attendance of ${t.mail} marked to ${t.status}`),e(t)}else a()}catch(e){a({message:e}),console.error("Error fetching JSON data:",e)}})}});
//# sourceMappingURL=AttendanceInjestPage.45b08241.js.map
